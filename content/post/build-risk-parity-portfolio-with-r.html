---
title: Build Risk Parity Portfolio with R
author: ''
date: '2020-01-12'
slug: build-risk-parity-portfolio-with-r
categories:
  - Risk management
tags:
  - Risk parity
description: ''
featured: ''
featuredalt: ''
featuredpath: ''
linktitle: ''
---



<pre class="r"><code>library(riskParityPortfolio)
library(fPortfolio)</code></pre>
<pre><code>## Loading required package: timeDate</code></pre>
<pre><code>## Loading required package: timeSeries</code></pre>
<pre><code>## Loading required package: fBasics</code></pre>
<pre><code>## Loading required package: fAssets</code></pre>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages ----------------------------------------------- tidyverse 1.3.0 --</code></pre>
<pre><code>## &lt;U+2713&gt; ggplot2 3.2.1     &lt;U+2713&gt; purrr   0.3.3
## &lt;U+2713&gt; tibble  2.1.3     &lt;U+2713&gt; dplyr   0.8.3
## &lt;U+2713&gt; tidyr   1.0.0     &lt;U+2713&gt; stringr 1.4.0
## &lt;U+2713&gt; readr   1.3.1     &lt;U+2713&gt; forcats 0.4.0</code></pre>
<pre><code>## -- Conflicts -------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks timeSeries::filter(), stats::filter()
## x dplyr::lag()    masks timeSeries::lag(), stats::lag()</code></pre>
<pre class="r"><code>library(RMySQL)</code></pre>
<pre><code>## Loading required package: DBI</code></pre>
<pre class="r"><code>library(lubridate)</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     date</code></pre>
<pre class="r"><code>library(timetk)</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;xts&#39;:
##   method     from
##   as.zoo.xts zoo</code></pre>
<pre class="r"><code>library(tidyquant)</code></pre>
<pre><code>## Loading required package: PerformanceAnalytics</code></pre>
<pre><code>## Loading required package: xts</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:timeSeries&#39;:
## 
##     time&lt;-</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre><code>## 
## Attaching package: &#39;xts&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     first, last</code></pre>
<pre><code>## 
## Attaching package: &#39;PerformanceAnalytics&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:timeDate&#39;:
## 
##     kurtosis, skewness</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     legend</code></pre>
<pre><code>## Loading required package: quantmod</code></pre>
<pre><code>## Loading required package: TTR</code></pre>
<pre><code>## 
## Attaching package: &#39;TTR&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:fBasics&#39;:
## 
##     volatility</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;quantmod&#39;:
##   method            from
##   as.zoo.data.frame zoo</code></pre>
<pre><code>## Version 0.4-0 included new data defaults. See ?getSymbols.</code></pre>
<pre><code>## -- Need to Learn tidyquant? ------------------------------------------------------------
## Business Science offers a 1-hour course - Learning Lab #9: Performance Analysis &amp; Portfolio Optimization with tidyquant!
## &lt;/&gt; Learn more at: https://university.business-science.io/p/learning-labs-pro &lt;/&gt;</code></pre>
<pre class="r"><code>library(PerformanceAnalytics)
library(tidyquant)

# Load data
## Establish a MySQL connection
con &lt;- dbConnect(MySQL(), dbname = &quot;stock_prices&quot;, user = &#39;root&#39; , password=&#39;paperback12&#39;)
prices &lt;- tbl(con, &quot;etfs&quot;)
#####
# Delete VOW from database
#####

# Get monthly returns
etf_returns &lt;- as_tibble(prices) %&gt;%
      select(date, symbol, adjusted) %&gt;%
      mutate(date = ymd(date)) %&gt;% 
      group_by(symbol) %&gt;%
      tq_transmute(select = adjusted, periodReturn, period=&quot;monthly&quot;, 
                   type=&quot;log&quot;, col_rename = &quot;monthly.returns&quot;) %&gt;% 
      pivot_wider(id_cols = date, names_from = symbol, values_from = monthly.returns) %&gt;%
      drop_na() %&gt;%
      tk_xts(select = -date, date_var = date)

dbDisconnect(con) # Disconnect from SQL database</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code># calculate covariance matrix
covariance &lt;- cov(coredata(etf_returns))

# compute risk parity portfolio
portfolio_parity &lt;- riskParityPortfolio(covariance)

# compute tangency portfolio
portfolio_tangency &lt;- tangencyPortfolio(as.timeSeries(etf_returns), 
                                        constraints = &quot;LongOnly&quot;)
portfolio_weights &lt;- rbind(portfolio_parity$w, getWeights(portfolio_tangency))
row.names(portfolio_weights)&lt;-c(&quot;Parity Portfolio&quot;, &quot;Tangency Portfolio&quot;)</code></pre>
