---
title: Build Risk Parity Portfolio with R
author: ''
date: '2020-01-12'
slug: build-risk-parity-portfolio-with-r
categories:
  - Risk management
tags:
  - Risk parity
description: ''
featured: ''
featuredalt: ''
featuredpath: ''
linktitle: ''
---


```{r}
library(riskParityPortfolio)
library(fPortfolio)
library(dplyr)
library(RMySQL)
library(lubridate)
library(tidyr)
library(timetk)
library(tidyquant)


# Load data
## Establish a MySQL connection
con <- dbConnect(MySQL(), dbname = "stock_prices", user = 'root' , password='paperback12')
etf_prices <- tbl(con, "etfs")
dbDisconnect(con) # Disconnect from SQL database

# Get monthly returns
etf_returns <- as_tibble(etf_prices) %>% select(date, symbol, adjusted) %>% 
      mutate(date = ymd(date)) %>% 
      pivot_wider(id_cols = date, names_from = symbol, values_from = adjusted) %>%
      tk_xts(select = -date, date_var = date) %>%
      to.monthly(indexAt = "last", OHLC = FALSE) %>% 
      Return.calculate(method = "log") %>% NaRV.omit()

# calculate covariance matrix
covariance <- cov(etf_returns)

# compute risk parity portfolio
portfolio_parity <- riskParityPortfolio(covariance)

# compute tangency portfolio
portfolio_tangency <- tangencyPortfolio(as.timeSeries(etf_returns), 
                                        constraints = "LongOnly")
portfolio_weights <- rbind(portfolio_parity$w, getWeights(portfolio_tangency))
row.names(portfolio_weights)<-c("Parity Portfolio", "Tangency Portfolio")
```

